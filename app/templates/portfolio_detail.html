{% extends "base.html" %}

{% block title %}{{ portfolio.title }}{% endblock %}

{% block content %}
<div class="page-header">
    <h1>{{ portfolio.title }} ({{ portfolio.type_label }})</h1>
</div>

<!-- 編集ボタンの追加 -->
{% if current_user.role == 'teacher' or current_user.id == portfolio.user_id %}
    <a href="{{ url_for('portfolio_edit', portfolio_id=portfolio.id) }}" class="btn btn-warning">ポートフォリオを編集</a>
{% endif %}

<!-- プログレスバーの表示 -->
<div class="progress" style="margin-top: 20px;">
  <div class="progress-bar" role="progressbar" style="width: {{ progress_percentage }}%;" aria-valuenow="{{ progress_percentage }}" aria-valuemin="0" aria-valuemax="100">
    {{ progress_percentage }}%
  </div>
</div>

<!-- 進捗情報の表示 -->
<h3>進捗一覧</h3>
{% if progress_updates %}
    <ul class="list-group">
        {% for progress in progress_updates %}
            <li class="list-group-item">
                <strong>進捗 {{ progress.progress_number }}:</strong> {{ progress.content }}
                <br>
                <small class="text-muted">{{ progress.timestamp }}</small>
            </li>
        {% endfor %}
    </ul>
{% else %}
    <p>まだ進捗がありません。</p>
{% endif %}

<!-- 進捗の追加フォーム（ポートフォリオの所有者のみ表示） -->
{% if current_user.id == portfolio.user_id %}
    <h4 style="margin-top: 30px;">進捗を追加する</h4>
    <form action="{{ url_for('add_progress', portfolio_id=portfolio.id) }}" method="POST">
        <div class="form-group">
            <textarea class="form-control" name="content" rows="3" required></textarea>
        </div>
        <button type="submit" class="btn btn-primary">追加</button>
    </form>
{% endif %}

<!-- コメント一覧 -->
<h3 style="margin-top: 40px;">コメント</h3>
<div class="comments">
    {% if comments %}
        {% for comment in comments %}
            <div class="comment">
                <p><strong>{{ comment.user_name }}:</strong> {{ comment.content }}</p>
                <p class="text-muted"><small>{{ comment.timestamp }}</small></p>
            </div>
        {% endfor %}
    {% else %}
        <p>コメントはまだありません。</p>
    {% endif %}
</div>

<!-- コメント投稿フォーム -->
<h4 style="margin-top: 30px;">コメントを投稿する</h4>
<form action="{{ url_for('portfolio_detail', portfolio_id=portfolio.id) }}" method="POST">
    <div class="form-group">
        <textarea class="form-control" name="content" rows="3" required></textarea>
    </div>
    <button type="submit" class="btn btn-primary">投稿</button>
</form>

<a href="{{ url_for('mypage') }}" class="btn btn-default" style="margin-top: 20px;">マイページに戻る</a>
{% endblock %}
